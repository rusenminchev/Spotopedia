@using Spotopedia.Common
@model Spotopedia.Web.ViewModels.Challenges.AllChallengesViewModel

@if (this.TempData.ContainsKey("AddNewEntry"))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @this.TempData["AddNewEntry"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (this.TempData.ContainsKey("DeleteEntry"))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @this.TempData["DeleteEntry"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}


@if (this.TempData.ContainsKey("AccessDenied"))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @this.TempData["AccessDenied"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}


@if (this.TempData.ContainsKey("EditChallenge"))
{
    <div class="alert alert-primary alert-dismissible fade show" role="alert">
        @this.TempData["EditChallenge"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (this.TempData.ContainsKey("DeleteChallenge"))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @this.TempData["DeleteChallenge"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<style>
    .wrapper {
        display: flex;
    }

        .wrapper > div:first-child {
            margin-right: 10px;
        }

        @*Delete Modal*@

    button.btn-primary {
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -100px;
    }

    .hide {
        display: none;
    }

    .show {
        display: block;
    }
</style>

<div class="col-md-10 offset-md-1">

    @if (this.User.IsInRole(GlobalConstants.AdministratorRoleName))
    {
        <div class="text-muted small ml-3"> <a type="button" asp-controller="Challenges" asp-action="Create" class="btn btn-outline-primary float-right"><i class="fa fa-plus"></i>&nbsp; Create New Challenge</a> </div>
        <div class="clearfix"></div>
        <br>
    }

    @foreach (var challenge in Model.Challenges)
    {
        <div class="card mb-3">
            <img src="@challenge.Image.ImageUrl" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title"><a asp-action="Details" asp-route-id="@challenge.Id">@challenge.Name</a></h5>
                @if (challenge.IsItActive)
                {
                    <span class="badge badge-pill badge-success">Active</span>
                }
                else
                {
                    <span class="badge badge-pill badge-danger">Expired</span>
                }

                <p class="card-text">@challenge.ShortDescription</p>
                <p class="card-text"><small class="text-muted">Challenge ends: @challenge.EndDate</small></p>

                @if (this.User.IsInRole(GlobalConstants.AdministratorRoleName))
                {
                    <hr>
                    <div class="wrapper float-right">
                        <div><a asp-controller="Challenges" asp-action="Edit" asp-route-id="@challenge.Id" class="btn btn-outline-warning float-right">Edit</a></div>
                        <div><a asp-controller="Challenges" asp-action="Delete" asp-route-id="@challenge.Id" class="btn btn-outline-danger float-right" data-toggle="modal" data-target="#myModal" onclick="openModal()">Delete</a></div>
                    </div>
                }
            </div>
        </div>
        <div class="container">
            <!-- The Modal -->
            <div class="modal" id="myModal">
                <div class="modal-dialog">

                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Delete Challenge Confirmation</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>

                        <!-- Modal body -->
                        <div class="modal-body">
                            Do you want to delete this challenge?
                        </div>

                        <!-- Modal footer -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <a asp-controller="Challenges" asp-action="Delete" asp-route-id="@challenge.Id" class="btn btn-outline-danger float-right" onclick="confirmDelete()">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts{
    <script>
        $('.dropdown').hover(function () {
            $(this).find('.dropdown-menu').stop(true, true).delay(200).fadeIn(500);
        }, function () {
            $(this).find('.dropdown-menu').stop(true, true).delay(200).fadeOut(500);
        });
    </script>

    <script>
        function confirmDelete() {
            console.log("Deleting...");
            $('.modal-header, .modal-footer, .modal-body').addClass('hide');
            $('.confirm-delete').removeClass('hide');
            //$('#myModal').modal('hide');
        }

        function openModal() {
            $('.confirm-delete').addClass('hide');
            $('#myModal .modal-header, .modal-footer, .modal-body').removeClass('hide');
            $('#myModal').modal('show');
        }
    </script>
}